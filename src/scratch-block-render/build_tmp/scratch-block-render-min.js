YUI.add("scratch-block-render",function(B){var G="#3851d2";var M=B.Base.create("roundedBasicBlock",B.Shape,[],{_draw:function(){var O=this.get("width"),R=this.get("height"),Q=this.get("ellipseWidth"),U=this.get("ellipseHeight"),T=this.get("showFooter"),S=this.get("showHeader"),P=this.get("connectorIndent"),V=this.get("connectorWidth");this.clear();this.moveTo(0,U);if(T){this.lineTo(0,R-2*U);this.quadraticCurveTo(0,R-U,Q,R-U);this.lineTo(P,R-U);this.quadraticCurveTo(P,R,P+Q,R);this.lineTo(P+V-Q,R);this.quadraticCurveTo(P+V,R,P+V,R-U);this.lineTo(O-Q,R-U);this.quadraticCurveTo(O,R-U,O,R-2*U);}else{this.lineTo(0,R-U);this.quadraticCurveTo(0,R,Q,R);this.lineTo(O-Q,R);this.quadraticCurveTo(O,R,O,R-U);}this.lineTo(O,U);this.quadraticCurveTo(O,0,O-Q,0);if(S){this.lineTo(P+V,0);this.quadraticCurveTo(P+V,U,P+V-Q,U);this.lineTo(P+Q,U);this.quadraticCurveTo(P,U,P,0);}this.lineTo(Q,0);this.quadraticCurveTo(0,0,0,U);this.end();}},{NAME:"roundedBasicBlock",ATTRS:B.mix({showHeader:{value:true},showFooter:{value:true},ellipseWidth:{value:5},ellipseHeight:{value:5},connectorIndent:{value:15},connectorWidth:{value:20}},B.Shape.ATTRS)});var A=B.Base.create("roundedContainerBlock",M,[],{_draw:function(){var W=this.get("width"),R=this.get("height"),T=this.get("ellipseWidth"),Q=this.get("ellipseHeight"),X=this.get("showFooter"),S=this.get("showHeader"),O=this.get("connectorIndent"),V=this.get("connectorWidth"),Y=this.get("bodyHeight"),U=this.get("footerHeight"),P=this.get("leftConnectorWidth");this.clear();this.moveTo(0,Q);if(X){this.lineTo(0,R-2*Q);this.quadraticCurveTo(0,R-Q,T,R-Q);this.lineTo(O,R-Q);this.quadraticCurveTo(O,R,O+T,R);this.lineTo(O+V-T,R);this.quadraticCurveTo(O+V,R,O+V,R-Q);this.lineTo(W-T,R-Q);this.quadraticCurveTo(W,R-Q,W,R-2*Q);}else{this.lineTo(0,R-Q);this.quadraticCurveTo(0,R,T,R);this.lineTo(W-T,R);this.quadraticCurveTo(W,R,W,R-Q);}this.lineTo(W,R-(U-Q));this.quadraticCurveTo(W,R-U,W-Q,R-U);this.lineTo(P+O+V,R-U);this.quadraticCurveTo(P+O+V,R-U+Q,P+O+V-T,R-U+Q);this.lineTo(P+O+T,R-U+Q);this.quadraticCurveTo(P+O,R-U+Q,P+O,R-U);this.lineTo(P+T,R-U);this.quadraticCurveTo(P,R-U,P,R-U-Q);this.lineTo(P,Y+Q);this.quadraticCurveTo(P,Y,P+T,Y);this.lineTo(P+O,Y);this.quadraticCurveTo(P+O,Y+Q,P+O+T,Y+Q);this.lineTo(P+O+V-T,Y+Q);this.quadraticCurveTo(P+O+V,Y+Q,P+O+V,Y);this.lineTo(W-T,Y);this.quadraticCurveTo(W,Y,W,Y-Q);this.lineTo(W,Q);this.quadraticCurveTo(W,0,W-T,0);if(S){this.lineTo(O+V,0);this.quadraticCurveTo(O+V,Q,O+V-T,Q);this.lineTo(O+T,Q);this.quadraticCurveTo(O,Q,O,0);}this.lineTo(T,0);this.quadraticCurveTo(0,0,0,Q);this.end();}},{NAME:"roundedContainerBlock",ATTRS:B.mix({bodyHeight:{value:15},leftConnectorWidth:{value:15},footerHeight:{value:25}},M.ATTRS)});var N=B.Base.create("graphicsBlockListRender",B.View,[],{container:'<div class="blockList"></div>',initializer:function(){var O=this.get("blockList");if(O){O.after("render",this.render,this);}},render:function(){var P=this.get("blockList"),Q=P,O=P.isInline();Q=P.get("blocks");P.detachAll("blocksChange");P.after("blocksChange",P.handleRender);if(!O){this.container.setStyle("left",P.get("x"));this.container.setStyle("top",P.get("y"));this.container.setStyle("position","absolute");}if(!this.container.inDoc()){this.get("parent").append(this.container);}this.container.setContent("");Q.each(function(U){var R=B.Node.create('<div class="blockWrapper"></div>'),S,T;this.container.append(R);T=new B.GraphicsBlockRender({block:U,parent:R,parentBlockList:this.get("blockList"),blockStageContainer:this.get("blockStageContainer")});T.render();S=T.container.get("region");R.setStyle("width",S.width);R.setStyle("height",S.height);},this);if(Q.size()===0&&O){this.container.setStyle("height","15px");}}},{ATTRS:{"blockStageContainer":{value:null},"blockList":{value:null},"parent":{value:null}}});B.GraphicsBlockListRender=N;var C=B.Base.create("graphicsBlockRender",B.View,[],{container:'<div class="basicBlock"></div>',blockBody:null,_copyOnDrag:false,initializer:function(){var P=this.get("block"),O="#55BA00";if(P){switch(P._category){case"motion":O=G;break;case"control":O="#d89d00";break;}P.after("render",this.render,this);}this.set("blockFillColor",O);},_renderBody:function(){var Q=this.get("block"),P=Q.get("inputBlocks"),V={},W=0,Y={},O=this.container,U;if(Q.type==="constant"){U=""+Q.get("value");}else{B.each(P,function(b,a){var c=B.guid();V[c]=b;Y[a]='<div id="'+c+'" class="basicBlock inputParentBlock"></div>';});B.each(Q._defaultInputBlocks,function(b,a){if(!P||!P[a]){var c=B.guid();V[c]=b;Y[a]='<div id="'+c+'" class="basicBlock inputParentBlock"></div>';}});U=Q.statement;}U=B.Escape.html(U);var X=/\{[^}]+\}/g,Z=U.split(X),S=U.match(X),T="";B.each(Z,function(b,a){var c=B.guid();V[c]=null;T+='<div id="'+c+'" class="basicBlock inputParentBlock">'+b+"</div>";if(S&&S[a]){T+=S[a];}});var R=B.substitute(T,Y);O.appendChild(R);B.each(V,function(b,c){var a=O.one("#"+c);if(b){this._renderBlock(O,b,a);}W=Math.max(W,a.get("region").height);},this);B.each(V,function(c,d){var b=O.one("#"+d);var a=W-b.get("region").height;b.setStyle("marginTop",Math.floor(a/2)+"px");b.setStyle("marginBottom",Math.ceil(a/2)+"px");},this);},_renderBlock:function(O,R,P){var Q=O.get("region");var S=new C({block:R,container:P,blockStageContainer:this.get("blockStageContainer")});S.render();},_renderInnerBlock:function(T){var S=this.get("block"),Q=S.get("innerBlocks");if(S._innerBlocksAllowed){if(!Q){Q=new B.BlockListModel({parent:S});S.set("innerBlocks",Q);}else{Q.set("parent",S);}var R=new N({parent:this.container,blockList:Q,blockStageContainer:this.get("blockStageContainer")});R.render();if(Q.get("blocks").size()===0&&!this._copyOnDrag){R.container.plug(B.Plugin.Drop);R.container.drop.on("drop:enter",this._handleEmptyInnerEnter,null,this);R.container.drop.on("drop:exit",this._handleEmptyInnerExit,null,this);}var O=parseInt(this.container.getStyle("paddingLeft").split("px")[0],10);var P=parseInt(this.container.getStyle("paddingTop").split("px")[0],10);R.container.setStyle("marginLeft",15-O);
R.container.setStyle("marginTop",T-P);}},_handleEmptyInnerEnter:function(Q,O){var P=Q.drag;var R=O.get("block");if(P){P.innerBlockList=R.get("innerBlocks");}},_handleEmptyInnerExit:function(Q,O){var P=B.DD.DDM.get("activeDrag");if(P&&P.innerBlockList&&P.innerBlockList.get("blocks").size()===0){P.innerBlockList=null;}},render:function(){var R=this.get("block"),P=this.container,U=this.get("parent"),O,S,Q,V,T,W;this.container.setContent("");if(!P.inDoc()&&U){U.append(this.container);}O=new B.Graphic({render:P});this._renderBody();T=P.get("region").width;W=P.get("region").height;this._renderInnerBlock(W);S=P.get("region");Q=S.width;V=S.height;if(R._innerBlocksAllowed){O.addShape({type:A,width:T,height:V+20,bodyHeight:W,x:0,y:0,fill:{color:this.get("blockFillColor")},stroke:{weight:0},showHeader:R._topBlocksAllowed,showFooter:R._bottomBlocksAllowed});P.setStyle("height",V+5);}else{O.addShape({type:M,width:Q,height:V+(R._bottomBlocksAllowed?5:0),x:0,y:0,fill:{color:this.get("blockFillColor")},stroke:{weight:0},showHeader:R._topBlocksAllowed,showFooter:R._bottomBlocksAllowed});}this._plugDragDrop();},_plugDragDrop:function(){this.container.plug(B.Plugin.Drag,{dragMode:"intersect"});this.container.plug(B.Plugin.Drop);this.container.dd.on("drag:start",this._bringToFront,null,this);this.container.dd.on("drag:end",this._bringToBack,null,this);this.container.drop.on("drop:enter",this._onDropEnter,null,this);this.container.drop.on("drop:exit",this._onDropExit,null,this);},_onDropEnter:function(Q,O){var P=Q.drag;var R=O.get("block");if(R._bottomBlocksAllowed||R._topBlocksAllowed){P.dstBlock=O.get("block");P.dstBlockList=O.get("parentBlockList");}},_onDropExit:function(Q,O){var P=B.DD.DDM.get("activeDrag");if(P&&P.dstBlock==O.get("block")){P.dstBlock=null;P.dstBlockList=null;}},_bringToFront:function(U,R){var T=R.get("parentBlockList"),S=this,V,Q,P=R.get("blockStageContainer"),O;U.stopPropagation();R.container.setStyle("zIndex",1);if(T&&P){V=T.splitBlockList(R.get("block"));Q=new N({parent:P,blockStageContainer:P,blockList:V});Q.render();S.blockList=V;R.setupModDD(Q.container,S);}if(R._copyOnDrag){O=new C({parent:R.get("parent"),block:R.get("block")});O.render();S.block=O.get("block").copy();R.setupModDD(O.container,S);}},setupModDD:function(O,P){P.set("dragNode",O);P.get("dragNode").setStyles({opacity:".5"});},_bringToBack:function(P,O){O.container.setStyle("zIndex",0);}},{ATTRS:{"parentBlockList":{value:null},"blockStageContainer":{value:null},"block":{value:null,writeOnce:true},"parent":{value:null},"blockFillColor":{value:"#3851d2"}}});B.GraphicsBlockRender=C;var K=B.Base.create("ScratchSpriteRender",B.View,[],{container:'<div class="sprite"></div>',initialize:function(){this.model.after("costumeChange",this.renderCostume,this);this.model.after("xChange",this._shapeChange,this);this.model.after("yChange",this._shapeChange,this);this.model.after("sizeChange",this._shapeChange,this);},_shapeChange:function(S){var O=this.container,P=this.model,Q=P.get("size"),R=P.get("costume");O.set("x",P.get("x"));O.set("y",P.get("y"));O.set("width",R.get("width")*Q);O.set("height",R.get("height")*Q);},render:function(){var O=this.model;this.renderCostume();},renderCostume:function(){var P=this.model.get("costume"),O=P.get("type");switch(O){case"rect":case"circle":this._renderShape(P);break;default:break;}},_renderShape:function(S){var R=S.get("style"),P=this.model,O=this.graphics,Q=P.get("size");this.container=O.addShape(B.mix({type:S.get("type"),x:P.get("x"),y:P.get("y"),width:S.get("width")*Q,height:S.get("height")*Q},R));}},{ATTRS:{parent:{value:null},graphics:{value:null}}});B.ScratchSpriteRender=K;var I=B.Base.create("ScratchStageRender",B.View,[],{_spriteRenders:null,container:'<div class="scratchStageRender"></div>',render:function(){var O=this.container,Q=this.get("sprites"),P=new B.Graphics(O);O.width=this.get("width");O.height=this.get("height");this._spriteRenders=Q.map(function(S){var R=new K({parent:this.container,model:S,graphics:P});R.render();},this);}},{ATTRS:{sprites:{values:null},width:{value:600},height:{value:600}}});B.ScratchStageRender=I;var D=function(O){this.init(O);};D.NS="scratch";D.prototype={init:function(O){if(O){this.tab=O.host;this.category=O.category;}if(this.tab){this.tab.after("selectedChange",B.bind(this.afterSelectedChange,this));}},loadBlocks:function(P){var Q=B.BlockDefinitionUtils.loadBlocksForCategory(P),O=B.Node.create('<div class="blockPrototypeContainer"></div>');this.tab.set("content",O);B.later(0,this,function(){B.each(Q,function(T){var R=B.Node.create('<div class="blockPrototypeWrapper"></div>'),S=new T(),U;O.append(R);U=new B.GraphicsBlockRender({parent:R,block:S});U._copyOnDrag=true;U.render();},this);});},afterSelectedChange:function(O){if(!this.loaded){this.loadBlocks(this.category);}}};var F=B.Base.create("blockCreationView",B.View,[],{render:function(){var P=new B.TabView(),O=this._getAllCategories();B.each(O,function(R){var Q=new B.Tab({label:R,content:""});Q.plug(D,{category:R});P.add(Q);});P.render(this.container);},_getAllCategories:function(){return B.Object.keys(B.SPRITE_BLOCK_DEFINITIONS);}},{ATTRS:{}});var E=B.Base.create("spriteScriptView",B.View,[],{render:function(){this.container.plug(B.Plugin.Drop);this.container.drop.on("drop:hit",this._onDropHit,null,this);this.container.drop.on("drop:enter",this._onDropEnter,null,this);this.container.drop.on("drop:exit",this._onDropExit,null,this);},_onDropHit:function(V,c){var S=c.container.get("region"),P=V.drag.get("dragNode").get("region"),U=V.drag.block,X=V.drag.innerBlockList,b=V.drag.blockList,T=V.drag.dstBlockList,Q=V.drag.dstBlock,W=V.drag.isTop,O=B.Node.create('<div class="blockListContainer"></div>'),a=Math.max(V.drag.region[0]-S[0],0),Y=Math.max(V.drag.region[1]-S[1],0),R,Z;if(X){T=X;}if(U){R=new B.BlockListModel({x:a,y:Y});U.set("parent",R);R.get("blocks").add(U);}else{if(b){R=b;R.set("x",a);R.set("y",Y);}}V.drag.get("dragNode").remove();if(T){c.addToBlockList(R,T,Q,W);}else{Z=new B.GraphicsBlockListRender({parent:c.container,blockList:R,blockStageContainer:c.container});
Z.render();}},addToBlockList:function(Q,U,P,V){var Y=U.get("blocks"),S=Y.indexOf(P);if(S===-1){V=true;S=0;}var T,O=new B.ModelList(),R=false,X=false,W=function(){var Z=Q.get("blocks");Z.each(function(a){a.set("parent",U);O.add(a);});R=true;};for(T=0;T<Y.size();T+=1){X=S===T;if(V&&X){W();}O.add(Y.item(T));if(!V&&X){W();}}if(!R){W();}U.set("blocks",O);},_onDropEnter:function(P,O){},_onDropExit:function(P,O){}},{ATTRS:{}});var H=B.Base.create("spriteStageView",B.View,[],{},{ATTRS:{}});var L=B.Base.create("spriteListView",B.View,[],{},{ATTRS:{}});var J=B.Base.create("scratchWorkstation",B.View,[],{blockSelectionView:null,spriteScriptView:null,spriteListView:null,spriteStageView:null,template:'<div class="scratchWorkstation yui3-g">'+'  <div class="blockSelection yui3-u-1-3"></div>'+'  <div class="spriteScript yui3-u-2-3"></div>'+'  <div class="spriteStage"></div>'+'  <div class="spriteList"></div>'+"</div>",render:function(){var O=this.container,Q=this.model,P,S,T,R;O.setContent(this.template);P=new F({container:O.one(".blockSelection"),model:Q});S=new E({container:O.one(".spriteScript"),model:Q});T=new H({container:O.one(".spriteStage"),model:Q});R=new L({container:O.one(".spriteList"),model:Q});P.render();T.render();S.render();R.render();}});B.ScratchWorkstation=J;},"@VERSION@",{use:["base","view","scratch-block-model","dd-plugin","dd-drop-plugin","graphics","substitute","escape","tabview"]});