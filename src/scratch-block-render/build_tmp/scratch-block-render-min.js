YUI.add("scratch-block-render",function(B){var L=B.Base.create("roundedBasicBlock",B.Shape,[],{_draw:function(){var N=this.get("width"),Q=this.get("height"),P=this.get("ellipseWidth"),T=this.get("ellipseHeight"),S=this.get("showFooter"),R=this.get("showHeader"),O=this.get("connectorIndent"),U=this.get("connectorWidth");this.clear();this.moveTo(0,T);if(S){this.lineTo(0,Q-2*T);this.quadraticCurveTo(0,Q-T,P,Q-T);this.lineTo(O,Q-T);this.quadraticCurveTo(O,Q,O+P,Q);this.lineTo(O+U-P,Q);this.quadraticCurveTo(O+U,Q,O+U,Q-T);this.lineTo(N-P,Q-T);this.quadraticCurveTo(N,Q-T,N,Q-2*T);}else{this.lineTo(0,Q-T);this.quadraticCurveTo(0,Q,P,Q);this.lineTo(N-P,Q);this.quadraticCurveTo(N,Q,N,Q-T);}this.lineTo(N,T);this.quadraticCurveTo(N,0,N-P,0);if(R){this.lineTo(O+U,0);this.quadraticCurveTo(O+U,T,O+U-P,T);this.lineTo(O+P,T);this.quadraticCurveTo(O,T,O,0);}this.lineTo(P,0);this.quadraticCurveTo(0,0,0,T);this.end();}},{NAME:"roundedBasicBlock",ATTRS:B.mix({showHeader:{value:true},showFooter:{value:true},ellipseWidth:{value:5},ellipseHeight:{value:5},connectorIndent:{value:15},connectorWidth:{value:20}},B.Shape.ATTRS)});var A=B.Base.create("roundedContainerBlock",L,[],{_draw:function(){var V=this.get("width"),Q=this.get("height"),S=this.get("ellipseWidth"),P=this.get("ellipseHeight"),W=this.get("showFooter"),R=this.get("showHeader"),N=this.get("connectorIndent"),U=this.get("connectorWidth"),X=this.get("bodyHeight"),T=this.get("footerHeight"),O=this.get("leftConnectorWidth");this.clear();this.moveTo(0,P);if(W){this.lineTo(0,Q-2*P);this.quadraticCurveTo(0,Q-P,S,Q-P);this.lineTo(N,Q-P);this.quadraticCurveTo(N,Q,N+S,Q);this.lineTo(N+U-S,Q);this.quadraticCurveTo(N+U,Q,N+U,Q-P);this.lineTo(V-S,Q-P);this.quadraticCurveTo(V,Q-P,V,Q-2*P);}else{this.lineTo(0,Q-P);this.quadraticCurveTo(0,Q,S,Q);this.lineTo(V-S,Q);this.quadraticCurveTo(V,Q,V,Q-P);}this.lineTo(V,Q-(T-P));this.quadraticCurveTo(V,Q-T,V-P,Q-T);this.lineTo(O+N+U,Q-T);this.quadraticCurveTo(O+N+U,Q-T+P,O+N+U-S,Q-T+P);this.lineTo(O+N+S,Q-T+P);this.quadraticCurveTo(O+N,Q-T+P,O+N,Q-T);this.lineTo(O+S,Q-T);this.quadraticCurveTo(O,Q-T,O,Q-T-P);this.lineTo(O,X+P);this.quadraticCurveTo(O,X,O+S,X);this.lineTo(O+N,X);this.quadraticCurveTo(O+N,X+P,O+N+S,X+P);this.lineTo(O+N+U-S,X+P);this.quadraticCurveTo(O+N+U,X+P,O+N+U,X);this.lineTo(V-S,X);this.quadraticCurveTo(V,X,V,X-P);this.lineTo(V,P);this.quadraticCurveTo(V,0,V-S,0);if(R){this.lineTo(N+U,0);this.quadraticCurveTo(N+U,P,N+U-S,P);this.lineTo(N+S,P);this.quadraticCurveTo(N,P,N,0);}this.lineTo(S,0);this.quadraticCurveTo(0,0,0,P);this.end();}},{NAME:"roundedContainerBlock",ATTRS:B.mix({bodyHeight:{value:15},leftConnectorWidth:{value:15},footerHeight:{value:25}},L.ATTRS)});var M=B.Base.create("graphicsBlockListRender",B.View,[],{container:'<div class="blockList"></div>',initializer:function(){},render:function(){var N=this.get("blockList"),O=N;if(!B.instanceOf(N,B.ModelList)){O=N.get("blocks");console.log(O.toArray());N.detachAll("blocksChange");N.after("blocksChange",this.render,this);this.container.setStyle("left",N.get("x"));this.container.setStyle("top",N.get("y"));this.container.setStyle("position","absolute");}if(!this.container.inDoc()){this.get("parent").append(this.container);}this.container.setContent("");O.each(function(S){var P=B.Node.create('<div class="blockWrapper"></div>'),Q,R;this.container.append(P);R=new B.GraphicsBlockRender({block:S,parent:P,parentBlockList:this.get("blockList"),blockStageContainer:this.get("blockStageContainer")});R.render();Q=R.container.get("region");P.setStyle("width",Q.width);P.setStyle("height",Q.height);},this);}},{ATTRS:{"blockStageContainer":{value:null},"blockList":{value:null},"parent":{value:null}}});B.GraphicsBlockListRender=M;var C=B.Base.create("graphicsBlockRender",B.View,[],{container:'<div class="basicBlock"></div>',blockBody:null,_copyOnDrag:false,initializer:function(){},_renderBody:function(){var P=this.get("block"),O=P.get("inputBlocks"),U={},V=0,X={},N=this.container,T;if(P.type==="constant"){T=""+P.get("value");}else{B.each(O,function(a,Z){var b=B.guid();U[b]=a;X[Z]='<div id="'+b+'" class="basicBlock inputParentBlock"></div>';});B.each(P._defaultInputBlocks,function(a,Z){if(!O||!O[Z]){var b=B.guid();U[b]=a;X[Z]='<div id="'+b+'" class="basicBlock inputParentBlock"></div>';}});T=P.statement;}T=B.Escape.html(T);var W=/\{[^}]+\}/g,Y=T.split(W),R=T.match(W),S="";B.each(Y,function(a,Z){var b=B.guid();U[b]=null;S+='<div id="'+b+'" class="basicBlock inputParentBlock">'+a+"</div>";if(R&&R[Z]){S+=R[Z];}});var Q=B.substitute(S,X);N.appendChild(Q);B.each(U,function(a,b){var Z=N.one("#"+b);if(a){this._renderBlock(N,a,Z);}V=Math.max(V,Z.get("region").height);},this);B.each(U,function(b,c){var a=N.one("#"+c);var Z=V-a.get("region").height;a.setStyle("marginTop",Math.floor(Z/2)+"px");a.setStyle("marginBottom",Math.ceil(Z/2)+"px");},this);},_renderBlock:function(N,Q,O){var P=N.get("region");var R=new C({block:Q,blockFillColor:Q.type==="constant"?"#999999":"#55BA00",container:O,blockStageContainer:this.get("blockStageContainer")});R.render();},_renderInnerBlock:function(S){var R=this.get("block"),P=R.get("innerBlocks");if(R._innerBlocksAllowed){var Q=new M({parent:this.container,blockList:P,blockStageContainer:this.get("blockStageContainer")});Q.render();var N=parseInt(this.container.getStyle("paddingLeft").split("px")[0],10);var O=parseInt(this.container.getStyle("paddingTop").split("px")[0],10);Q.container.setStyle("marginLeft",15-N);Q.container.setStyle("marginTop",S-O);}},render:function(){var Q=this.get("block"),O=this.container,T=this.get("parent"),N,R,P,U,S,V;if(!O.inDoc()&&T){T.append(this.container);}N=new B.Graphic({render:O});this._renderBody();S=O.get("region").width;V=O.get("region").height;this._renderInnerBlock(V);R=O.get("region");P=R.width;U=R.height;if(Q._innerBlocksAllowed){N.addShape({type:A,width:S,height:U+20,bodyHeight:V,x:0,y:0,fill:{color:this.get("blockFillColor")},stroke:{weight:0},showHeader:Q._topBlocksAllowed,showFooter:Q._bottomBlocksAllowed});
}else{N.addShape({type:L,width:P,height:U+(Q._bottomBlocksAllowed?5:0),x:0,y:0,fill:{color:this.get("blockFillColor")},stroke:{weight:0},showHeader:Q._topBlocksAllowed,showFooter:Q._bottomBlocksAllowed});}this._plugDragDrop();},_plugDragDrop:function(){if(this.container.dd){this.container.dd.detatchAll("drag:start");this.container.dd.detatchAll("drag:end");}if(this.container.drop){this.container.drop.detatchAll("drop:enter");this.container.drop.detatchAll("drop:exit");this.container.drop.detatchAll("drop:hit");}this.container.plug(B.Plugin.Drag,{dragMode:"intersect"});this.container.plug(B.Plugin.Drop);this.container.dd.on("drag:start",this._bringToFront,null,this);this.container.dd.on("drag:end",this._bringToBack,null,this);this.container.drop.on("drop:enter",this._onDropEnter,null,this);this.container.drop.on("drop:exit",this._onDropExit,null,this);this.container.drop.on("drop:hit",this._onDropHit,null,this);},_onDropEnter:function(P,N){var O=P.drag;var Q=N.get("block");if(Q._bottomBlocksAllowed||Q._topBlocksAllowed){O.dstBlock=N.get("block");O.dstBlockList=N.get("parentBlockList");}console.log(N.get("block").statement+" drop enter");},_onDropExit:function(P,N){var O=B.DD.DDM.get("activeDrag");if(O&&O.dstBlock==N.get("block")){O.dstBlock=null;O.dstBlockList=null;}console.log(N.get("block").statement+" drop exit");},_onDropHit:function(O,N){console.log("drop hit");console.log(O);},_bringToFront:function(T,Q){var S=Q.get("parentBlockList"),R=this,U,P,O=Q.get("blockStageContainer"),N;T.stopPropagation();Q.container.setStyle("zIndex",1);if(S&&O){U=S.splitBlockList(Q.get("block"));P=new M({parent:O,blockStageContainer:O,blockList:U});P.render();R.blockList=U;Q.setupModDD(P.container,R);}if(Q._copyOnDrag){N=new C({parent:Q.get("parent"),block:Q.get("block")});N.container=B.Node.create(C.prototype.container);N.render();R.block=N.get("block").copy();console.log("before: "+R.block.get("id"));R.block.set("id",B.guid());console.log("after: "+R.block.get("id"));Q.setupModDD(N.container,R);}},setupModDD:function(N,O){O.set("dragNode",N);O.get("dragNode").setStyles({opacity:".5"});},_bringToBack:function(O,N){N.container.setStyle("zIndex",0);}},{ATTRS:{"parentBlockList":{value:null},"blockStageContainer":{value:null},"block":{value:null,writeOnce:true},"parent":{value:null},"blockFillColor":{value:"#3851d2"}}});B.GraphicsBlockRender=C;var J=B.Base.create("ScratchSpriteRender",B.View,[],{container:'<div class="sprite"></div>',initialize:function(){this.model.after("costumeChange",this.renderCostume,this);this.model.after("xChange",this._shapeChange,this);this.model.after("yChange",this._shapeChange,this);this.model.after("sizeChange",this._shapeChange,this);},_shapeChange:function(R){var N=this.container,O=this.model,P=O.get("size"),Q=O.get("costume");N.set("x",O.get("x"));N.set("y",O.get("y"));N.set("width",Q.get("width")*P);N.set("height",Q.get("height")*P);},render:function(){var N=this.model;this.renderCostume();},renderCostume:function(){var O=this.model.get("costume"),N=O.get("type");switch(N){case"rect":case"circle":this._renderShape(O);break;default:break;}},_renderShape:function(R){var Q=R.get("style"),O=this.model,N=this.graphics,P=O.get("size");this.container=N.addShape(B.mix({type:R.get("type"),x:O.get("x"),y:O.get("y"),width:R.get("width")*P,height:R.get("height")*P},Q));}},{ATTRS:{parent:{value:null},graphics:{value:null}}});B.ScratchSpriteRender=J;var H=B.Base.create("ScratchStageRender",B.View,[],{_spriteRenders:null,container:'<div class="scratchStageRender"></div>',render:function(){var N=this.container,P=this.get("sprites"),O=new B.Graphics(N);N.width=this.get("width");N.height=this.get("height");this._spriteRenders=P.map(function(R){var Q=new J({parent:this.container,model:R,graphics:O});Q.render();},this);}},{ATTRS:{sprites:{values:null},width:{value:600},height:{value:600}}});B.ScratchStageRender=H;var D=function(N){this.init(N);};D.NS="scratch";D.prototype={init:function(N){if(N){this.tab=N.host;this.category=N.category;}if(this.tab){this.tab.after("selectedChange",B.bind(this.afterSelectedChange,this));}},loadBlocks:function(O){var P=B.BlockDefinitionUtils.loadBlocksForCategory(O),N=B.Node.create('<div class="blockPrototypeContainer"></div>');this.tab.set("content",N);B.later(0,this,function(){B.each(P,function(S){var Q=B.Node.create('<div class="blockPrototypeWrapper"></div>'),R=new S(),T;N.append(Q);T=new B.GraphicsBlockRender({parent:Q,block:R});T._copyOnDrag=true;T.render();},this);});},afterSelectedChange:function(N){if(!this.loaded){this.loadBlocks(this.category);}}};var F=B.Base.create("blockCreationView",B.View,[],{render:function(){var O=new B.TabView(),N=this._getAllCategories();B.each(N,function(Q){var P=new B.Tab({label:Q,content:""});P.plug(D,{category:Q});O.add(P);});O.render(this.container);},_getAllCategories:function(){return B.Object.keys(B.SPRITE_BLOCK_DEFINITIONS);}},{ATTRS:{}});var E=B.Base.create("spriteScriptView",B.View,[],{render:function(){this.container.plug(B.Plugin.Drop);this.container.drop.on("drop:hit",this._onDropHit,null,this);this.container.drop.on("drop:enter",this._onDropEnter,null,this);this.container.drop.on("drop:exit",this._onDropExit,null,this);},_onDropHit:function(U,a){var R=a.container.get("region"),O=U.drag.get("dragNode").get("region"),T=U.drag.block,Z=U.drag.blockList,S=U.drag.dstBlockList,P=U.drag.dstBlock,V=U.drag.isTop,N=B.Node.create('<div class="blockListContainer"></div>'),Y=Math.max(U.drag.region[0]-R[0],0),W=Math.max(U.drag.region[1]-R[1],0),Q,X;if(T){Q=new B.BlockListModel({x:Y,y:W});Q.get("blocks").add(T);}else{if(Z){Q=Z;Q.set("x",Y);Q.set("y",W);}}U.drag.get("dragNode").remove();if(S){a.addToBlockList(Q,S,P,V);}else{X=new B.GraphicsBlockListRender({parent:a.container,blockList:Q,blockStageContainer:a.container});X.render();}},addToBlockList:function(P,T,O,U){var X=T.get("blocks"),R=X.indexOf(O);if(R===-1){U=true;R=0;}var S,N=new B.ModelList(),Q=false,W=false,V=function(){var Y=P.get("blocks");N.add(Y.toArray());Q=true;};
for(S=0;S<X.size();S+=1){W=R===S;if(U&&W){V();}N.add(X.item(S));if(!U&&W){V();}}if(!Q){V();}T.set("blocks",N);},_onDropEnter:function(O,N){},_onDropExit:function(O,N){}},{ATTRS:{}});var G=B.Base.create("spriteStageView",B.View,[],{},{ATTRS:{}});var K=B.Base.create("spriteListView",B.View,[],{},{ATTRS:{}});var I=B.Base.create("scratchWorkstation",B.View,[],{blockSelectionView:null,spriteScriptView:null,spriteListView:null,spriteStageView:null,template:'<div class="scratchWorkstation yui3-g">'+'  <div class="blockSelection yui3-u-1-3"></div>'+'  <div class="spriteScript yui3-u-2-3"></div>'+'  <div class="spriteStage"></div>'+'  <div class="spriteList"></div>'+"</div>",render:function(){var N=this.container,P=this.model,O,R,S,Q;N.setContent(this.template);O=new F({container:N.one(".blockSelection"),model:P});R=new E({container:N.one(".spriteScript"),model:P});S=new G({container:N.one(".spriteStage"),model:P});Q=new K({container:N.one(".spriteList"),model:P});O.render();S.render();R.render();Q.render();}});B.ScratchWorkstation=I;},"@VERSION@",{use:["base","view","scratch-block-model","dd-plugin","dd-drop-plugin","graphics","substitute","escape","tabview"]});