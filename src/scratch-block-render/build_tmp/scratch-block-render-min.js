YUI.add("scratch-block-render",function(B){var G="#3851d2";var J=function(P){P.node=P.host;this.block=P.block;J.superclass.constructor.apply(this,arguments);};B.extend(J,B.Plugin.Drop,{initDropAndRegion:function(){B.DD.DDM._addValid(this);this.region=this.get("node").get("region");B.DD.DDM.useHash=false;},destroy:function(){B.DD.DDM._unregTarget(this);B.each(B.DD.DDM.otherDrops,function(Q,P){if(Q===this){delete B.DD.DDM.otherDrops[P];}},this);J.superclass.destroy.call(this);},initializer:function(){if(!this.block){B.later(0,this,function(){this.initDropAndRegion();});}else{this.initDropAndRegion();}},sizeShim:function(){if(!B.DD.DDM.activeDrag){return false;}if(this.get("node")===B.DD.DDM.activeDrag.get("node")){return false;}if(this.get("lock")){return false;}if(!this.shim){B.later(100,this,this.sizeShim);return false;}this.region=this.get("node").get("region");}},{NAME:"ignore-offset-drop-plugin",NS:"drop"});var N=B.Base.create("roundedBasicBlock",B.Shape,[],{_draw:function(){var Q=this.get("width"),T=this.get("height"),S=this.get("ellipseWidth"),V=this.get("ellipseHeight"),U=this.get("showBottomConnector"),P=this.get("showTopConnector"),R=this.get("connectorIndent"),W=this.get("connectorWidth");this.clear();this.moveTo(0,V);if(U){this.lineTo(0,T-2*V);this.quadraticCurveTo(0,T-V,S,T-V);this.lineTo(R,T-V);this.quadraticCurveTo(R,T,R+S,T);this.lineTo(R+W-S,T);this.quadraticCurveTo(R+W,T,R+W,T-V);this.lineTo(Q-S,T-V);this.quadraticCurveTo(Q,T-V,Q,T-2*V);}else{this.lineTo(0,T-V);this.quadraticCurveTo(0,T,S,T);this.lineTo(Q-S,T);this.quadraticCurveTo(Q,T,Q,T-V);}this.lineTo(Q,V);this.quadraticCurveTo(Q,0,Q-S,0);if(P){this.lineTo(R+W,0);this.quadraticCurveTo(R+W,V,R+W-S,V);this.lineTo(R+S,V);this.quadraticCurveTo(R,V,R,0);}this.lineTo(S,0);this.quadraticCurveTo(0,0,0,V);this.end();}},{NAME:"roundedBasicBlock",ATTRS:B.mix({showTopConnector:{value:true},showBottomConnector:{value:true},ellipseWidth:{value:5},ellipseHeight:{value:5},connectorIndent:{value:15},connectorWidth:{value:20}},B.Shape.ATTRS)});var A=B.Base.create("roundedContainerBlock",N,[],{_draw:function(){var Y=this.get("width"),S=this.get("height"),V=this.get("ellipseWidth"),R=this.get("ellipseHeight"),U=this.get("showBottomConnector"),T=this.get("showTopConnector"),P=this.get("connectorIndent"),X=this.get("connectorWidth"),Z=this.get("bodyHeight"),W=this.get("footerHeight"),Q=this.get("leftConnectorWidth");this.clear();this.moveTo(0,R);if(U){this.lineTo(0,S-2*R);this.quadraticCurveTo(0,S-R,V,S-R);this.lineTo(P,S-R);this.quadraticCurveTo(P,S,P+V,S);this.lineTo(P+X-V,S);this.quadraticCurveTo(P+X,S,P+X,S-R);this.lineTo(Y-V,S-R);this.quadraticCurveTo(Y,S-R,Y,S-2*R);}else{this.lineTo(0,S-R);this.quadraticCurveTo(0,S,V,S);this.lineTo(Y-V,S);this.quadraticCurveTo(Y,S,Y,S-R);}this.lineTo(Y,S-(W-R));this.quadraticCurveTo(Y,S-W,Y-R,S-W);this.lineTo(Q+P+X,S-W);this.quadraticCurveTo(Q+P+X,S-W+R,Q+P+X-V,S-W+R);this.lineTo(Q+P+V,S-W+R);this.quadraticCurveTo(Q+P,S-W+R,Q+P,S-W);this.lineTo(Q+V,S-W);this.quadraticCurveTo(Q,S-W,Q,S-W-R);this.lineTo(Q,Z+R);this.quadraticCurveTo(Q,Z,Q+V,Z);this.lineTo(Q+P,Z);this.quadraticCurveTo(Q+P,Z+R,Q+P+V,Z+R);this.lineTo(Q+P+X-V,Z+R);this.quadraticCurveTo(Q+P+X,Z+R,Q+P+X,Z);this.lineTo(Y-V,Z);this.quadraticCurveTo(Y,Z,Y,Z-R);this.lineTo(Y,R);this.quadraticCurveTo(Y,0,Y-V,0);if(T){this.lineTo(P+X,0);this.quadraticCurveTo(P+X,R,P+X-V,R);this.lineTo(P+V,R);this.quadraticCurveTo(P,R,P,0);}this.lineTo(V,0);this.quadraticCurveTo(0,0,0,R);this.end();}},{NAME:"roundedContainerBlock",ATTRS:B.mix({bodyHeight:{value:15},leftConnectorWidth:{value:15},footerHeight:{value:25}},N.ATTRS)});var O=B.Base.create("graphicsBlockListRender",B.View,[],{_currentBlockRenders:null,container:'<div class="blockList"></div>',hover:null,initializer:function(){var P=this.get("blockList");if(P){P.after("render",this.render,this);P.after("destroy",this.destroy,this);}},destroy:function(){this._clearContents();O.superclass.destroy.call(this);this.container.remove();},render:function(){var Q=this.get("blockList"),R=Q.get("blocks"),P=Q.isInline();if(!P){this.container.setStyle("left",Q.get("x"));this.container.setStyle("top",Q.get("y"));this.container.setStyle("position","absolute");}if(!this.container.inDoc()){this.get("parent").append(this.container);}this._clearContents();this._currentBlockRenders=[];R.each(function(V){var S=B.Node.create('<div class="blockWrapper"></div>'),T,U;this.container.append(S);U=new B.GraphicsBlockRender({block:V,parent:S,parentBlockList:this.get("blockList"),blockStageContainer:this.get("blockStageContainer"),plugDragDrop:this.get("plugDragDrop")});U.render();T=U.container.get("region");S.setStyle("width",T.width);S.setStyle("height",T.height);this._currentBlockRenders.push(U);},this);if(R.size()===0&&P){this.container.setStyle("height","15px");}},_clearContents:function(){if(this.container.drop){this.container.drop.destroy();}if(this._currentBlockRenders){B.Array.each(this._currentBlockRenders,function(P){if(P.container.drop){P.container.drop.destroy();}if(P.container.dd){P.container.dd.destroy();}if(P.innerBlockRender){P.innerBlockRender.destroy();}P.container.remove();});}this.container.setContent("");}},{ATTRS:{"blockStageContainer":{value:null},"blockList":{value:null},"parent":{value:null},"plugDragDrop":{value:true},"hoverStatus":{value:null}}});B.GraphicsBlockListRender=O;var C=B.Base.create("graphicsBlockRender",B.View,[],{container:'<div class="basicBlock"></div>',innerBlockRender:null,blockBody:null,_copyOnDrag:false,initializer:function(){var Q=this.get("block"),P="#55BA00";if(Q){switch(Q._category){case"motion":P=G;break;case"control":P="#d89d00";break;}Q.after("render",this.render,this);}this.set("blockFillColor",P);this.after("hoverStatusChange",this._renderHoverStatus);},_renderHoverStatus:function(S){if(this.hover){this.hover.remove();}var P=this.get("hoverStatus");if(P==="top"||P==="bottom"){var Q=B.Node.create("<div></div>");Q.setStyle("width","80px");Q.setStyle("height","15px");Q.setStyle("opacity",0.5);
Q.setStyle("backgroundColor","#000");Q.setStyle("position","absolute");Q.setStyle("zIndex",999);var R=this.container.get("region");if((R.width===0&&R.height===0)&&this.container.drop&&this.container.drop.region){R=this.container.drop.region;}B.one("body").appendChild(Q);Q.setXY([R.left,P==="top"?R.top:R.bottom]);this.hover=Q;}},_renderBody:function(){var R=this.get("block"),Q=R.get("inputBlocks"),W={},X=0,Z={},P=this.container,V;if(R.type==="constant"){V=""+R.get("value");}else{B.each(Q,function(c,b){var d=B.guid();W[d]=c;Z[b]='<div id="'+d+'" class="basicBlock inputParentBlock"></div>';});B.each(R._defaultInputBlocks,function(c,b){if(!Q||!Q[b]){var d=B.guid();W[d]=c;Z[b]='<div id="'+d+'" class="basicBlock inputParentBlock"></div>';}});V=R.statement;}V=B.Escape.html(V);var Y=/\{[^}]+\}/g,a=V.split(Y),T=V.match(Y),U="";B.each(a,function(c,b){var d=B.guid();W[d]=null;U+='<div id="'+d+'" class="basicBlock inputParentBlock">'+c+"</div>";if(T&&T[b]){U+=T[b];}});var S=B.substitute(U,Z);P.appendChild(S);B.each(W,function(c,d){var b=P.one("#"+d);if(c){this._renderBlock(P,c,b);}X=Math.max(X,b.get("region").height);},this);B.each(W,function(d,e){var c=P.one("#"+e);var b=X-c.get("region").height;c.setStyle("marginTop",Math.floor(b/2)+"px");c.setStyle("marginBottom",Math.ceil(b/2)+"px");},this);},_renderBlock:function(P,S,Q){var R=P.get("region");var T=new C({block:S,container:Q,blockStageContainer:this.get("blockStageContainer"),plugDragDrop:false});T.render();},_renderInnerBlock:function(U){var T=this.get("block"),R=T.get("innerBlocks");if(T._innerBlocksAllowed){if(!R){R=new B.BlockListModel({parent:T});T.set("innerBlocks",R);}else{R.set("parent",T);}var S=new O({parent:this.container,blockList:R,blockStageContainer:this.get("blockStageContainer"),plugDragDrop:this.get("plugDragDrop")});S.after("hoverStatusChange",this._renderHoverStatus);S.render();if(R.get("blocks").size()===0&&!this._copyOnDrag&&this.get("plugDragDrop")){S.container.plug(J);S.container.drop.on("drop:enter",this._onDropEnter,this,R,S);S.container.drop.on("drop:exit",this._onDropExit,this,R,S);}var P=parseInt(this.container.getStyle("paddingLeft").split("px")[0],10);var Q=parseInt(this.container.getStyle("paddingTop").split("px")[0],10);S.container.setStyle("marginLeft",15-P);S.container.setStyle("marginTop",U-Q);this.innerBlockRender=S;}},render:function(){var S=this.get("block"),Q=this.container,V=this.get("parent"),P,T,R,W,U,X;this.container.setContent("");if(!Q.inDoc()&&V){V.append(this.container);}P=new B.Graphic({render:Q});this._renderBody();U=Q.get("region").width;X=Q.get("region").height;this._renderInnerBlock(X);T=Q.get("region");R=T.width;W=T.height;if(S._innerBlocksAllowed){P.addShape({type:A,width:U,height:W+20,bodyHeight:X,x:0,y:0,fill:{color:this.get("blockFillColor")},stroke:{weight:0},showTopConnector:S._topBlocksAllowed,showBottomConnector:S._bottomBlocksAllowed});Q.setStyle("height",W+5);}else{P.addShape({type:N,width:R,height:W+(S._bottomBlocksAllowed?5:0),x:0,y:0,fill:{color:this.get("blockFillColor")},stroke:{weight:0},showTopConnector:S._topBlocksAllowed,showBottomConnector:S._bottomBlocksAllowed});}if(S._topBlocksAllowed){Q.setStyle("width",R);}this._plugDragDrop();},_plugDragDrop:function(){if(this.get("plugDragDrop")){this.container.plug(B.Plugin.Drag,{dragMode:"point"});this.container.dd.on("drag:start",this._onDragStart,null,this);if(!this._copyOnDrag){this.container.plug(J,{block:this.get("block")});this.container.drop.on("drop:over",this._onDropEnter,this,this.get("block"),this);this.container.drop.on("drop:enter",this._onDropEnter,this,this.get("block"),this);this.container.drop.on("drop:exit",this._onDropExit,this,this.get("block"),this);}}},_updateDropStack:function(Q,T,R,P){var V=Q.dropStack,U,S=B.Array.find(V,function(W){return W.target===T;});if(!S){S={target:T,render:R};V.push(S);}else{U=B.Array.indexOf(S);if(U!==-1){V[U]=V[V.length-1];V[V.length-1]=S;}}S.isTop=P;this._updateHoverStatus(V);},_updateHoverStatus:function(Q){var P;if(Q.length>0){P=Q[Q.length-1];P.render.set("hoverStatus",P.target.getHoverStatus(P.isTop));}B.Array.each(Q,function(R,S){if(S!==Q.length-1){R.render.set("hoverStatus",null);}});},_determineIsTop:function(S,P){var T=P.region.top,R=P.region.bottom,Q=S.mouseXY[1];return Math.abs(Q-T)<Math.abs(Q-R);},_removeFromDropStack:function(Q,P){var S=Q.dropStack,R=B.Array.find(S,function(T){return T.target===P;});Q.dropStack=B.Array.reject(S,function(T){return T===R;});S=Q.dropStack;if(R){R.render.set("hoverStatus",null);this._updateHoverStatus(S);}},_onDropEnter:function(U,T,S){var R=U.drag,P=R.dragTarget,Q;if(T.isValidDropTarget(P)){Q=this._determineIsTop(R,U.drop);this._updateDropStack(R,T,S,Q);}},_onDropExit:function(R,P){var Q=B.DD.DDM.activeDrag;if(Q){this._removeFromDropStack(Q,P);}},_onDragStart:function(V,S){var U=S.get("parentBlockList"),T=this,W,R,Q=S.get("blockStageContainer"),P;V.stopPropagation();T.dropStack=[];if(U&&Q){W=U.splitBlockList(S.get("block"));R=new O({parent:Q,blockStageContainer:Q,blockList:W,plugDragDrop:false});R.render();T.dragTarget=W;S.setupModDD(R.container,T);}if(S._copyOnDrag){P=new C({parent:S.get("parent"),block:S.get("block").copy(),plugDragDrop:false});P.render();T.dragTarget=P.get("block").copy();S.setupModDD(P.container,T);}},setupModDD:function(P,Q){Q.set("dragNode",P);Q.get("dragNode").setStyles({opacity:".5",zIndex:1});}},{ATTRS:{"parentBlockList":{value:null},"blockStageContainer":{value:null},"block":{value:null,writeOnce:true},"parent":{value:null},"blockFillColor":{value:"#3851d2"},"plugDragDrop":{value:true},"hoverStatus":{value:null}}});B.GraphicsBlockRender=C;var L=B.Base.create("ScratchSpriteRender",B.View,[],{container:'<div class="sprite"></div>',initialize:function(){this.model.after("costumeChange",this.renderCostume,this);this.model.after("xChange",this._shapeChange,this);this.model.after("yChange",this._shapeChange,this);this.model.after("sizeChange",this._shapeChange,this);},_shapeChange:function(T){var P=this.container,Q=this.model,R=Q.get("size"),S=Q.get("costume");
P.set("x",Q.get("x"));P.set("y",Q.get("y"));P.set("width",S.get("width")*R);P.set("height",S.get("height")*R);},render:function(){var P=this.model;this.renderCostume();},renderCostume:function(){var Q=this.model.get("costume"),P=Q.get("type");switch(P){case"rect":case"circle":this._renderShape(Q);break;default:break;}},_renderShape:function(T){var S=T.get("style"),Q=this.model,P=this.graphics,R=Q.get("size");this.container=P.addShape(B.mix({type:T.get("type"),x:Q.get("x"),y:Q.get("y"),width:T.get("width")*R,height:T.get("height")*R},S));}},{ATTRS:{parent:{value:null},graphics:{value:null}}});B.ScratchSpriteRender=L;var I=B.Base.create("ScratchStageRender",B.View,[],{_spriteRenders:null,container:'<div class="scratchStageRender"></div>',render:function(){var P=this.container,R=this.get("sprites"),Q=new B.Graphics(P);P.width=this.get("width");P.height=this.get("height");this._spriteRenders=R.map(function(T){var S=new L({parent:this.container,model:T,graphics:Q});S.render();},this);}},{ATTRS:{sprites:{values:null},width:{value:600},height:{value:600}}});B.ScratchStageRender=I;var D=function(P){this.init(P);};D.NS="scratch";D.prototype={init:function(P){if(P){this.tab=P.host;this.category=P.category;}if(this.tab){this.tab.after("selectedChange",B.bind(this.afterSelectedChange,this));}},loadBlocks:function(Q){var R=B.BlockDefinitionUtils.loadBlocksForCategory(Q),P=B.Node.create('<div class="blockPrototypeContainer"></div>');this.tab.set("content",P);B.later(0,this,function(){B.each(R,function(U){var S=B.Node.create('<div class="blockPrototypeWrapper"></div>'),T=new U(),V;P.append(S);V=new B.GraphicsBlockRender({parent:S,block:T});V._copyOnDrag=true;V.render();},this);});},afterSelectedChange:function(P){if(!this.loaded){this.loadBlocks(this.category);}}};var F=B.Base.create("blockCreationView",B.View,[],{render:function(){var Q=new B.TabView(),P=this._getAllCategories();B.each(P,function(S){var R=new B.Tab({label:S,content:""});R.plug(D,{category:S});Q.add(R);});Q.render(this.container);},_getAllCategories:function(){return B.Object.keys(B.SPRITE_BLOCK_DEFINITIONS);}},{ATTRS:{}});var E=B.Base.create("spriteScriptView",B.View,[],{render:function(){this.container.plug(B.Plugin.Drop);B.DD.DDM.on("drag:drophit",this._onDragEnd,null,this);},_onDragEnd:function(X,f){var U=f.container.get("region"),W=X.drag,Q=X.drag.get("dragNode").get("region"),c=Math.max(X.drag.region[0]-U[0],0),a=Math.max(X.drag.region[1]-U[1],0),b,T,d,Z=W.dragTarget,V,R,S,Y;B.Array.each(W.dropStack,function(e){e.render.set("hoverStatus",null);});if(W.dropStack.length>0){T=W.dropStack[W.dropStack.length-1];if(T.target.type==="blockList"){V=T.target;}else{S=T.target.get("parent");if(S.type==="blockList"){V=S;R=T.target;}}Y=T.isTop;}if(Z.type!=="blockList"){d=new B.BlockListModel();var P=d.get("blocks");P.add(Z);d.set("blocks",P);}else{d=new B.BlockListModel();d.set("blocks",Z.get("blocks"));Z.destroy();}X.drag.get("dragNode").remove();if(V){f.addToBlockList(d,V,R,Y);}else{d.set("x",c);d.set("y",a);b=new B.GraphicsBlockListRender({parent:f.container,blockList:d,blockStageContainer:f.container});b.render();}},addToBlockList:function(R,V,Q,W){var Z=V.get("blocks"),T=Z.indexOf(Q);if(T===-1){W=true;T=0;}var U,P=new B.ModelList(),S=false,Y=false,X=function(){var a=R.get("blocks");a.each(function(b){P.add(b);});S=true;};for(U=0;U<Z.size();U+=1){Y=T===U;if(W&&Y){X();}P.add(Z.item(U));if(!W&&Y){X();}}if(!S){X();}V.set("blocks",P);R.set("blocks",new B.ModelList());R.destroy();}},{ATTRS:{}});var H=B.Base.create("spriteStageView",B.View,[],{},{ATTRS:{}});var M=B.Base.create("spriteListView",B.View,[],{},{ATTRS:{}});var K=B.Base.create("scratchWorkstation",B.View,[],{blockSelectionView:null,spriteScriptView:null,spriteListView:null,spriteStageView:null,template:'<div class="scratchWorkstation yui3-g">'+'  <div class="blockSelection yui3-u-1-3"></div>'+'  <div class="spriteScript yui3-u-2-3"></div>'+'  <div class="spriteStage"></div>'+'  <div class="spriteList"></div>'+"</div>",render:function(){var P=this.container,R=this.model,Q,T,U,S;P.setContent(this.template);Q=new F({container:P.one(".blockSelection"),model:R});T=new E({container:P.one(".spriteScript"),model:R});U=new H({container:P.one(".spriteStage"),model:R});S=new M({container:P.one(".spriteList"),model:R});Q.render();U.render();T.render();S.render();}});B.ScratchWorkstation=K;},"@VERSION@",{use:["base","view","scratch-block-model","dd-plugin","dd-drop-plugin","graphics","substitute","escape","tabview"]});