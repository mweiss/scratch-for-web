YUI.add("scratch-block-render",function(D){var Q=D.Base.create("roundedBasicBlock",D.Shape,[],{_draw:function(){var U=this.get("width"),X=this.get("height"),W=this.get("ellipseWidth"),Z=this.get("ellipseHeight"),Y=this.get("showBottomConnector"),T=this.get("showTopConnector"),V=this.get("connectorIndent"),a=this.get("connectorWidth");this.clear();this.moveTo(0,Z);if(Y){this.lineTo(0,X-2*Z);this.quadraticCurveTo(0,X-Z,W,X-Z);this.lineTo(V,X-Z);this.quadraticCurveTo(V,X,V+W,X);this.lineTo(V+a-W,X);this.quadraticCurveTo(V+a,X,V+a,X-Z);this.lineTo(U-W,X-Z);this.quadraticCurveTo(U,X-Z,U,X-2*Z);}else{this.lineTo(0,X-Z);this.quadraticCurveTo(0,X,W,X);this.lineTo(U-W,X);this.quadraticCurveTo(U,X,U,X-Z);}this.lineTo(U,Z);this.quadraticCurveTo(U,0,U-W,0);if(T){this.lineTo(V+a,0);this.quadraticCurveTo(V+a,Z,V+a-W,Z);this.lineTo(V+W,Z);this.quadraticCurveTo(V,Z,V,0);}this.lineTo(W,0);this.quadraticCurveTo(0,0,0,Z);this.end();}},{NAME:"roundedBasicBlock",ATTRS:D.mix({showTopConnector:{value:true},showBottomConnector:{value:true},ellipseWidth:{value:5},ellipseHeight:{value:5},connectorIndent:{value:15},connectorWidth:{value:20}},D.Shape.ATTRS)});var L=D.Base.create("roundedContainerBlock",Q,[],{_draw:function(){var c=this.get("width"),W=this.get("height"),Z=this.get("ellipseWidth"),V=this.get("ellipseHeight"),Y=this.get("showBottomConnector"),X=this.get("showTopConnector"),T=this.get("connectorIndent"),b=this.get("connectorWidth"),d=this.get("bodyHeight"),a=this.get("footerHeight"),U=this.get("leftConnectorWidth");this.clear();this.moveTo(0,V);if(Y){this.lineTo(0,W-2*V);this.quadraticCurveTo(0,W-V,Z,W-V);this.lineTo(T,W-V);this.quadraticCurveTo(T,W,T+Z,W);this.lineTo(T+b-Z,W);this.quadraticCurveTo(T+b,W,T+b,W-V);this.lineTo(c-Z,W-V);this.quadraticCurveTo(c,W-V,c,W-2*V);}else{this.lineTo(0,W-V);this.quadraticCurveTo(0,W,Z,W);this.lineTo(c-Z,W);this.quadraticCurveTo(c,W,c,W-V);}this.lineTo(c,W-(a-V));this.quadraticCurveTo(c,W-a,c-V,W-a);this.lineTo(U+T+b,W-a);this.quadraticCurveTo(U+T+b,W-a+V,U+T+b-Z,W-a+V);this.lineTo(U+T+Z,W-a+V);this.quadraticCurveTo(U+T,W-a+V,U+T,W-a);this.lineTo(U+Z,W-a);this.quadraticCurveTo(U,W-a,U,W-a-V);this.lineTo(U,d+V);this.quadraticCurveTo(U,d,U+Z,d);this.lineTo(U+T,d);this.quadraticCurveTo(U+T,d+V,U+T+Z,d+V);this.lineTo(U+T+b-Z,d+V);this.quadraticCurveTo(U+T+b,d+V,U+T+b,d);this.lineTo(c-Z,d);this.quadraticCurveTo(c,d,c,d-V);this.lineTo(c,V);this.quadraticCurveTo(c,0,c-Z,0);if(X){this.lineTo(T+b,0);this.quadraticCurveTo(T+b,V,T+b-Z,V);this.lineTo(T+Z,V);this.quadraticCurveTo(T,V,T,0);}this.lineTo(Z,0);this.quadraticCurveTo(0,0,0,V);this.end();}},{NAME:"roundedContainerBlock",ATTRS:D.mix({bodyHeight:{value:15},leftConnectorWidth:{value:15},footerHeight:{value:25}},Q.ATTRS)});D.RoundedBasicBlock=Q;D.RoundedContainerBlock=L;var B=function(T){T.node=T.host;this.block=T.block;B.superclass.constructor.apply(this,arguments);};D.extend(B,D.Plugin.Drop,{initDropAndRegion:function(){D.DD.DDM._addValid(this);this.region=this.get("node").get("region");D.DD.DDM.useHash=false;},destroy:function(){D.DD.DDM._unregTarget(this);D.each(D.DD.DDM.otherDrops,function(U,T){if(U===this){delete D.DD.DDM.otherDrops[T];}},this);B.superclass.destroy.call(this);},initializer:function(){if(!this.block){D.later(0,this,function(){this.initDropAndRegion();});}else{this.initDropAndRegion();}},sizeShim:function(){if(!D.DD.DDM.activeDrag){return false;}if(this.get("node")===D.DD.DDM.activeDrag.get("node")){return false;}if(this.get("lock")){return false;}if(!this.shim){D.later(100,this,this.sizeShim);return false;}this.region=this.get("node").get("region");}},{NAME:"ignore-offset-drop-plugin",NS:"drop"});D.IgnoreOffsetDrop=B;var N="#3851d2";var F,G,S,K;K=function(T){var U=T.model;switch(U.type){case"block":return new F(T);case"numberInput":case"degreeInput":return new G(T);case"menuInput":return new S(T);default:return new F(T);}};var R=D.Base.create("baseGraphicsRender",D.View,[],{hover:null,renderHoverStatus:function(W){if(this.hover){this.hover.remove();}var T=this.get("hoverStatus");if(T==="top"||T==="bottom"){var U=D.Node.create("<div></div>");U.setStyle("width","80px");U.setStyle("height","15px");U.setStyle("opacity",0.5);U.setStyle("backgroundColor","#000");U.setStyle("position","absolute");U.setStyle("zIndex",999);var V=this.container.get("region");if((V.width===0&&V.height===0)&&this.container.drop&&this.container.drop.region){V=this.container.drop.region;}D.one("body").appendChild(U);U.setXY([V.left,T==="top"?V.top:V.bottom]);this.hover=U;}}},{ATTRS:{"blockStageContainer":{value:null},"parent":{value:null},"plugDragDrop":{value:true},"hoverStatus":{value:null}}});var I=D.Base.create("graphicsBlockListRender",R,[],{_currentBlockRenders:null,container:'<div class="blockList"></div>',hover:null,initializer:function(){var T=this.model;if(T){T.after("render",this.render,this);T.after("destroy",this.destroy,this);}},destroy:function(){this._clearContents();I.superclass.destroy.call(this);this.container.remove();},render:function(){var U=this.model,V=U.get("blocks"),T=U.isInline();if(!T){this.container.setStyle("left",U.get("x"));this.container.setStyle("top",U.get("y"));this.container.setStyle("position","absolute");}if(!this.container.inDoc()){this.get("parent").append(this.container);}this._clearContents();this._currentBlockRenders=[];V.each(function(Z){var W=D.Node.create('<div class="blockWrapper"></div>'),X,Y;this.container.append(W);Y=D.GraphicsBlockRender({model:Z,parent:W,blockStageContainer:this.get("blockStageContainer"),plugDragDrop:this.get("plugDragDrop")});Y.render();X=Y.container.get("region");W.setStyle("width",X.width);W.setStyle("height",X.height);this._currentBlockRenders.push(Y);},this);if(V.size()===0&&T){this.container.setStyle("height","15px");}},_clearContents:function(){if(this.container.drop){this.container.drop.destroy();}if(this._currentBlockRenders){D.Array.each(this._currentBlockRenders,function(T){if(T.container.drop){T.container.drop.destroy();}if(T.container.dd){T.container.dd.destroy();
}if(T.innerBlockRender){T.innerBlockRender.destroy();}T.container.remove();});}this.container.setContent("");}});D.GraphicsBlockListRender=I;F=D.Base.create("graphicsBlockRender",R,[],{container:'<div class="basicBlock"></div>',innerBlockRender:null,blockBody:null,_copyOnDrag:false,initializer:function(){var U=this.model,T="#55BA00";if(U){switch(U._category){case"motion":T=N;break;case"control":T="#d89d00";break;}U.after("render",this.render,this);}this.set("blockFillColor",T);this.after("hoverStatusChange",this.renderHoverStatus);},_renderBody:function(){var V=this.model,U=V.get("inputBlocks"),a={},b=0,d={},T=this.container,Z;if(V.type==="constant"){Z=""+V.get("value");}else{D.each(U,function(g,f){var h=D.guid();a[h]=g;d[f]='<div id="'+h+'" class="basicBlock inputParentBlock"></div>';});D.each(V._defaultInputBlocks,function(g,f){if(!U||!U[f]){var h=D.guid();a[h]=g;d[f]='<div id="'+h+'" class="basicBlock inputParentBlock"></div>';}});Z=V.statement;}Z=D.Escape.html(Z);var c=/\{[^}]+\}/g,e=Z.split(c),X=Z.match(c),Y="";D.each(e,function(g,f){var h=D.guid();a[h]=null;Y+='<div id="'+h+'" class="basicBlock inputParentBlock">'+g+"</div>";if(X&&X[f]){Y+=X[f];}});var W=D.substitute(Y,d);T.appendChild(W);D.each(a,function(g,h){var f=T.one("#"+h);if(g){this._renderBlock(T,g,f);}b=Math.max(b,f.get("region").height);},this);D.each(a,function(h,i){var g=T.one("#"+i);var f=b-g.get("region").height;g.setStyle("marginTop",Math.floor(f/2)+"px");g.setStyle("marginBottom",Math.ceil(f/2)+"px");},this);},_renderBlock:function(T,W,U){var V=T.get("region");var X=K({model:W,container:U,blockStageContainer:this.get("blockStageContainer")});X.render();},_renderInnerBlock:function(Y){var X=this.model,V=X.get("innerBlocks");if(X._innerBlocksAllowed){if(!V){V=new D.BlockListModel({parent:X});X.set("innerBlocks",V);}else{V.set("parent",X);}var W=new I({parent:this.container,model:V,blockStageContainer:this.get("blockStageContainer"),plugDragDrop:this.get("plugDragDrop")});W.after("hoverStatusChange",this.renderHoverStatus);W.render();if(V.get("blocks").size()===0&&!this._copyOnDrag&&this.get("plugDragDrop")){W.container.plug(D.IgnoreOffsetDrop);W.container.drop.on("drop:enter",this._onDropEnter,this,V,W);W.container.drop.on("drop:exit",this._onDropExit,this,V,W);}var T=parseInt(this.container.getStyle("paddingLeft").split("px")[0],10);var U=parseInt(this.container.getStyle("paddingTop").split("px")[0],10);W.container.setStyle("marginLeft",15-T);W.container.setStyle("marginTop",Y-U);this.innerBlockRender=W;}},render:function(){var V=this.model,T=this.container,Z=this.get("parent"),W,X,U,a,Y,b,c=V.type==="block";this.container.setContent("");if(!T.inDoc()&&Z){Z.append(this.container);}if(c){W=new D.Graphic({render:T});}this._renderBody();Y=T.get("region").width;b=T.get("region").height;this._renderInnerBlock(b);X=T.get("region");U=X.width;a=X.height;if(c){this._renderBackground(W,V,U,a,Y,b);}if(V._topBlocksAllowed){T.setStyle("width",U);}this._plugDragDrop();},_renderBackground:function(V,Y,W,U,T,X){if(Y._innerBlocksAllowed){V.addShape({type:D.RoundedContainerBlock,width:T,height:U+20,bodyHeight:X,x:0,y:0,fill:{color:this.get("blockFillColor")},stroke:{weight:0},showTopConnector:Y._topBlocksAllowed,showBottomConnector:Y._bottomBlocksAllowed});this.container.setStyle("height",U+5);}else{V.addShape({type:D.RoundedBasicBlock,width:W,height:U+(Y._bottomBlocksAllowed?5:0),x:0,y:0,fill:{color:this.get("blockFillColor")},stroke:{weight:0},showTopConnector:Y._topBlocksAllowed,showBottomConnector:Y._bottomBlocksAllowed});}},_plugDragDrop:function(){if(this.get("plugDragDrop")){this._plugDrag();if(!this._copyOnDrag){this.container.plug(D.IgnoreOffsetDrop,{block:this.model});this.container.drop.on("drop:over",this._onDropEnter,this,this.model,this);this.container.drop.on("drop:enter",this._onDropEnter,this,this.model,this);this.container.drop.on("drop:exit",this._onDropExit,this,this.model,this);}}},_plugDrag:function(){this.container.plug(D.Plugin.Drag,{dragMode:"point"});this.container.dd.on("drag:start",this._onDragStart,null,this);},_updateDropStack:function(U,X,V,T){var Z=U.dropStack,Y,W=D.Array.find(Z,function(a){return a.target===X;});if(!W){W={target:X,render:V};Z.push(W);}else{Y=D.Array.indexOf(W);if(Y!==-1){Z[Y]=Z[Z.length-1];Z[Z.length-1]=W;}}W.isTop=T;this._updateHoverStatus(Z);},_updateHoverStatus:function(U){var T;if(U.length>0){T=U[U.length-1];T.render.set("hoverStatus",T.target.getHoverStatus(T.isTop));}D.Array.each(U,function(V,W){if(W!==U.length-1){V.render.set("hoverStatus",null);}});},_determineIsTop:function(W,T){var X=T.region.top,V=T.region.bottom,U=W.mouseXY[1];return Math.abs(U-X)<Math.abs(U-V);},_removeFromDropStack:function(U,T){var W=U.dropStack,V=D.Array.find(W,function(X){return X.target===T;});U.dropStack=D.Array.reject(W,function(X){return X===V;});W=U.dropStack;if(V){V.render.set("hoverStatus",null);this._updateHoverStatus(W);}},_onDropEnter:function(Y,X,W){var V=Y.drag,T=V.dragTarget,U;if(X.isValidDropTarget(T)){U=this._determineIsTop(V,Y.drop);this._updateDropStack(V,X,W,U);}},_onDropExit:function(V,T){var U=D.DD.DDM.activeDrag;if(U){this._removeFromDropStack(U,T);}},_onDragStart:function(X,b){var Z=b.model.get("parent"),U=Z&&Z.type==="blockList"?Z:null,V=this,W,Y,a=b.get("blockStageContainer"),T;X.stopPropagation();V.dropStack=[];if(U&&U.isSingleReturnValueBlock()){U=null;}if(U&&a){W=U.splitBlockList(b.model);Y=new I({parent:a,blockStageContainer:a,model:W,plugDragDrop:false});Y.render();V.dragTarget=W;b.setupModDD(Y.container,V);}else{if(b._copyOnDrag){T=K({parent:b.get("parent"),model:b.model.copy(),plugDragDrop:false});T.render();V.dragTarget=T.model.copy();b.setupModDD(T.container,V);}else{V.dragTarget=b.model;if(Z&&Z.type==="blockList"){Z.splitBlockList(b.model);}else{if(Z){Z.removeInputBlock(b.model);}}T=K({parent:a,blockStageContainer:a,model:b.model,plugDragDrop:false});T.render();b.setupModDD(T.container,V);}}},setupModDD:function(T,U){U.set("dragNode",T);U.get("dragNode").setStyles({opacity:".5",zIndex:1});
}},{ATTRS:{"blockFillColor":{value:"#3851d2"}}});G=D.Base.create("numberInputBlockRender",F,[],{_plugDrag:function(){},_renderBody:function(){var T=this.model;this.container.appendChild('<input type="number" value="'+T.get("value")+'"></input>');this.container.one("input").after("change",function(U){T.set("value",U.target.get("value"));});}});S=D.Base.create("menuInputBlockRender",F,[],{_renderBody:function(){var W=this.model,T=this.model.get("values"),V=this.model.get("value");var U="<select>";D.Array.each(T,function(X){U+='<option value="'+X.value+'" '+(X.value===V?"selected ":"")+">"+X.name+"</option>";});U+="</select>";this.container.appendChild(U);this.container.one("select").after("change",function(Y){var X=Y.target.get("selectedIndex");W.set("value",T[X].value);});},_plugDrag:function(){}});D.GraphicsBlockRender=K;var A=D.Base.create("ScratchSpriteRender",D.View,[],{container:'<div class="sprite"></div>',initialize:function(){this.model.after("costumeChange",this.renderCostume,this);this.model.after("xChange",this._shapeChange,this);this.model.after("yChange",this._shapeChange,this);this.model.after("sizeChange",this._shapeChange,this);},_shapeChange:function(X){var T=this.container,U=this.model,V=U.get("size"),W=U.get("costume");T.set("x",U.get("x"));T.set("y",U.get("y"));T.set("width",W.get("width")*V);T.set("height",W.get("height")*V);},render:function(){var T=this.model;this.renderCostume();},renderCostume:function(){var U=this.model.get("costume"),T=U.get("type");switch(T){case"rect":case"circle":this._renderShape(U);break;default:break;}},_renderShape:function(X){var W=X.get("style"),U=this.model,T=this.graphics,V=U.get("size");this.container=T.addShape(D.mix({type:X.get("type"),x:U.get("x"),y:U.get("y"),width:X.get("width")*V,height:X.get("height")*V},W));}},{ATTRS:{parent:{value:null},graphics:{value:null}}});D.ScratchSpriteRender=A;var E=D.Base.create("ScratchStageRender",D.View,[],{_spriteRenders:null,container:'<div class="scratchStageRender"></div>',render:function(){var T=this.container,V=this.get("sprites"),U=new D.Graphics(T);T.width=this.get("width");T.height=this.get("height");this._spriteRenders=V.map(function(X){var W=new A({parent:this.container,model:X,graphics:U});W.render();},this);}},{ATTRS:{sprites:{values:null},width:{value:600},height:{value:600}}});D.ScratchStageRender=E;var M=function(T){this.init(T);};M.NS="scratch";M.prototype={init:function(T){if(T){this.tab=T.host;this.category=T.category;}if(this.tab){this.tab.after("selectedChange",D.bind(this.afterSelectedChange,this));}},loadBlocks:function(U){var V=D.BlockDefinitionUtils.loadBlocksForCategory(U),T=D.Node.create('<div class="blockPrototypeContainer"></div>');this.tab.set("content",T);D.later(0,this,function(){D.each(V,function(Y){var W=D.Node.create('<div class="blockPrototypeWrapper"></div>'),X=new Y(),Z;T.append(W);Z=D.GraphicsBlockRender({parent:W,model:X});Z._copyOnDrag=true;Z.render();},this);});},afterSelectedChange:function(T){if(!this.loaded){this.loadBlocks(this.category);}}};var P=D.Base.create("blockCreationView",D.View,[],{render:function(){var U=new D.TabView(),T=this._getAllCategories();D.each(T,function(W){var V=new D.Tab({label:W,content:""});V.plug(M,{category:W});U.add(V);});U.render(this.container);},_getAllCategories:function(){return D.Object.keys(D.SPRITE_BLOCK_DEFINITIONS);}},{ATTRS:{}});var H=D.Base.create("spriteScriptView",D.View,[],{render:function(){this.container.plug(D.Plugin.Drop);D.DD.DDM.on("drag:drophit",this._onDragEnd,null,this);},_onDragEnd:function(Y,c){var W=Y.drag,V,a=W.dragTarget,X,T,b,U,Z;D.Array.each(W.dropStack,function(d){d.render.set("hoverStatus",null);});if(W.dropStack.length>0){V=W.dropStack[W.dropStack.length-1];if(V.target.type==="blockList"){X=V.target;}else{U=V.target.get("parent");T=V.target;if(U.type==="blockList"){X=U;}else{b=true;}}Z=V.isTop;}Y.drag.get("dragNode").remove();if(X){c.addToBlockList(c._createSrcBlockList(a),X,T,Z);}else{if(b&&a.type!=="blockList"){c._replaceInputBlock(T,a);}else{c._createNewBlockList(W,a);}}},_createNewBlockList:function(V,T){var a=this.container.get("region"),Y=V.get("dragNode").get("region"),X=Math.max(V.region[0]-a[0],0),W=Math.max(V.region[1]-a[1],0),Z,U;U=this._createSrcBlockList(T);U.set("x",X);U.set("y",W);Z=new D.GraphicsBlockListRender({parent:this.container,model:U,blockStageContainer:this.container});Z.render();},_replaceInputBlock:function(V,T){var Y=V.get("parent");var a,U=false,W=Y.get("inputBlocks"),Z,X;D.each(W,function(c,b){if(V===c){a=b;}});D.each(Y._defaultInputBlocks,function(c,b){if(V===c){U=true;}});if(a!==null){Y.setInputBlock(a,T);}if(!U){Z=this._createSrcBlockList(V);Z.set("x",0);Z.set("y",0);X=new D.GraphicsBlockListRender({parent:this.container,model:Z,blockStageContainer:this.container});X.render();}},_createSrcBlockList:function(T){var U,V;if(T.type!=="blockList"){U=new D.BlockListModel();V=U.get("blocks");V.add(T);U.set("blocks",V);}else{U=new D.BlockListModel();U.set("blocks",T.get("blocks"));T.destroy();}return U;},addToBlockList:function(V,Z,U,a){var d=Z.get("blocks"),X=d.indexOf(U);if(X===-1){a=true;X=0;}var Y,T=new D.ModelList(),W=false,c=false,b=function(){var e=V.get("blocks");e.each(function(f){T.add(f);});W=true;};for(Y=0;Y<d.size();Y+=1){c=X===Y;if(a&&c){b();}T.add(d.item(Y));if(!a&&c){b();}}if(!W){b();}Z.set("blocks",T);V.set("blocks",new D.ModelList());V.destroy();}},{ATTRS:{}});var C=D.Base.create("spriteStageView",D.View,[],{},{ATTRS:{}});var J=D.Base.create("spriteListView",D.View,[],{},{ATTRS:{}});var O=D.Base.create("scratchWorkstation",D.View,[],{blockSelectionView:null,spriteScriptView:null,spriteListView:null,spriteStageView:null,template:'<div class="scratchWorkstation yui3-g">'+'  <div class="blockSelection yui3-u-1-3"></div>'+'  <div class="spriteScript yui3-u-2-3"></div>'+'  <div class="spriteStage"></div>'+'  <div class="spriteList"></div>'+"</div>",render:function(){var T=this.container,V=this.model,U,X,Y,W;T.setContent(this.template);U=new P({container:T.one(".blockSelection"),model:V});
X=new H({container:T.one(".spriteScript"),model:V});Y=new C({container:T.one(".spriteStage"),model:V});W=new J({container:T.one(".spriteList"),model:V});U.render();Y.render();X.render();W.render();}});D.ScratchWorkstation=O;},"@VERSION@",{use:["base","view","scratch-block-model","dd-plugin","dd-drop-plugin","graphics","substitute","escape","tabview"]});