YUI.add("scratch-block-render",function(E){var D=E.Base.create("roundedBasicBlock",E.Shape,[],{_draw:function(){var F=this.get("width"),I=this.get("height"),H=this.get("ellipseWidth"),L=this.get("ellipseHeight"),K=this.get("showFooter"),J=this.get("showHeader"),G=this.get("connectorIndent"),M=this.get("connectorWidth");this.clear();this.moveTo(0,L);if(K){this.lineTo(0,I-2*L);this.quadraticCurveTo(0,I-L,H,I-L);this.lineTo(G,I-L);this.quadraticCurveTo(G,I,G+H,I);this.lineTo(G+M-H,I);this.quadraticCurveTo(G+M,I,G+M,I-L);this.lineTo(F-H,I-L);this.quadraticCurveTo(F,I-L,F,I-2*L);}else{this.lineTo(0,I-L);this.quadraticCurveTo(0,I,H,I);this.lineTo(F-H,I);this.quadraticCurveTo(F,I,F,I-L);}this.lineTo(F,L);this.quadraticCurveTo(F,0,F-H,0);if(J){this.lineTo(G+M,0);this.quadraticCurveTo(G+M,L,G+M-H,L);this.lineTo(G+H,L);this.quadraticCurveTo(G,L,G,0);}this.lineTo(H,0);this.quadraticCurveTo(0,0,0,L);this.end();}},{NAME:"roundedBasicBlock",ATTRS:E.mix({showHeader:{value:true},showFooter:{value:true},ellipseWidth:{value:5},ellipseHeight:{value:5},connectorIndent:{value:15},connectorWidth:{value:20}},E.Shape.ATTRS)});var B=E.Base.create("roundedContainerBlock",D,[],{_draw:function(){var N=this.get("width"),I=this.get("height"),K=this.get("ellipseWidth"),H=this.get("ellipseHeight"),O=this.get("showFooter"),J=this.get("showHeader"),F=this.get("connectorIndent"),M=this.get("connectorWidth"),P=this.get("bodyHeight"),L=this.get("footerHeight"),G=this.get("leftConnectorWidth");this.clear();this.moveTo(0,H);if(O){this.lineTo(0,I-2*H);this.quadraticCurveTo(0,I-H,K,I-H);this.lineTo(F,I-H);this.quadraticCurveTo(F,I,F+K,I);this.lineTo(F+M-K,I);this.quadraticCurveTo(F+M,I,F+M,I-H);this.lineTo(N-K,I-H);this.quadraticCurveTo(N,I-H,N,I-2*H);}else{this.lineTo(0,I-H);this.quadraticCurveTo(0,I,K,I);this.lineTo(N-K,I);this.quadraticCurveTo(N,I,N,I-H);}this.lineTo(N,I-(L-H));this.quadraticCurveTo(N,I-L,N-H,I-L);this.lineTo(G+F+M,I-L);this.quadraticCurveTo(G+F+M,I-L+H,G+F+M-K,I-L+H);this.lineTo(G+F+K,I-L+H);this.quadraticCurveTo(G+F,I-L+H,G+F,I-L);this.lineTo(G+K,I-L);this.quadraticCurveTo(G,I-L,G,I-L-H);this.lineTo(G,P+H);this.quadraticCurveTo(G,P,G+K,P);this.lineTo(G+F,P);this.quadraticCurveTo(G+F,P+H,G+F+K,P+H);this.lineTo(G+F+M-K,P+H);this.quadraticCurveTo(G+F+M,P+H,G+F+M,P);this.lineTo(N-K,P);this.quadraticCurveTo(N,P,N,P-H);this.lineTo(N,H);this.quadraticCurveTo(N,0,N-K,0);if(J){this.lineTo(F+M,0);this.quadraticCurveTo(F+M,H,F+M-K,H);this.lineTo(F+K,H);this.quadraticCurveTo(F,H,F,0);}this.lineTo(K,0);this.quadraticCurveTo(0,0,0,H);this.end();}},{NAME:"roundedContainerBlock",ATTRS:E.mix({bodyHeight:{value:15},leftConnectorWidth:{value:15},footerHeight:{value:25}},D.ATTRS)});var A=E.Base.create("graphicsBlockListRender",E.View,[],{container:'<div class="blockList"></div>',render:function(){var F=this.get("blockList");if(!this.container.inDoc()){this.get("parent").append(this.container);}F.each(function(J){var G=E.Node.create('<div class="blockWrapper"></div>'),H,I;this.container.append(G);I=new E.GraphicsBlockRender({block:J,parent:G});I.render();H=I.container.get("region");G.setStyle("width",H.width);G.setStyle("height",H.height);},this);}},{ATTRS:{"blockList":{value:null},"parent":{value:null}}});E.GraphicsBlockListRender=A;var C=E.Base.create("graphicsBlockRender",E.View,[],{container:'<div class="basicBlock"></div>',blockBody:null,initializer:function(){},_renderBody:function(){var H=this.get("block"),G=H.get("inputBlocks"),M={},N=0,P={},F=this.container,L;if(H.type==="constant"){L=""+H.get("value");}else{E.each(G,function(S,R){var T=E.guid();M[T]=S;P[R]='<div id="'+T+'" class="basicBlock inputParentBlock"></div>';});L=H.statement;}L=E.Escape.html(L);var O=/\{[^}]+\}/g,Q=L.split(O),J=L.match(O),K="";E.each(Q,function(S,R){var T=E.guid();M[T]=null;K+='<div id="'+T+'" class="basicBlock inputParentBlock">'+S+"</div>";if(J&&J[R]){K+=J[R];}});var I=E.substitute(K,P);F.appendChild(I);E.each(M,function(S,T){var R=F.one("#"+T);if(S){this._renderBlock(F,S,R);}N=Math.max(N,R.get("region").height);},this);E.each(M,function(T,U){var S=F.one("#"+U);var R=N-S.get("region").height;S.setStyle("marginTop",Math.floor(R/2)+"px");S.setStyle("marginBottom",Math.ceil(R/2)+"px");},this);},_renderBlock:function(F,I,G){var H=F.get("region");var J=new C({block:I,blockFillColor:I.type==="constant"?"#999999":"#55BA00",container:G});J.render();},_renderInnerBlock:function(K){var J=this.get("block"),H=J.get("innerBlocks");if(J._innerBlocksAllowed){var I=new A({parent:this.container,blockList:H});I.render();var F=parseInt(this.container.getStyle("paddingLeft").split("px")[0],10);var G=parseInt(this.container.getStyle("paddingTop").split("px")[0],10);I.container.setStyle("marginLeft",15-F);I.container.setStyle("marginTop",K-G);}},render:function(){var M=this.get("block"),H=this.container,L,J,I,G,F,K;if(!H.inDoc()){this.get("parent").append(this.container);}L=new E.Graphic({render:H});this._renderBody();F=H.get("region").width;K=H.get("region").height;this._renderInnerBlock(K);J=H.get("region");I=J.width;G=J.height;if(M._innerBlocksAllowed){L.addShape({type:B,width:F,height:G+20,bodyHeight:K,x:0,y:0,fill:{color:this.get("blockFillColor")},stroke:{weight:0},showHeader:M._topBlocksAllowed,showFooter:M._bottomBlocksAllowed});}else{L.addShape({type:D,width:I,height:G+(M._bottomBlocksAllowed?5:0),x:0,y:0,fill:{color:this.get("blockFillColor")},stroke:{weight:0},showHeader:M._topBlocksAllowed,showFooter:M._bottomBlocksAllowed});}this.container.plug(E.Plugin.Drag,{dragMode:"intersect"});this.container.plug(E.Plugin.Drop);this.container.dd.on("drag:start",this._bringToFront,this);this.container.dd.on("drag:end",this._bringToBack,this);},_bringToFront:function(F){this.container.setStyle("zIndex",1);},_bringToBack:function(F){this.container.setStyle("zIndex",0);}},{ATTRS:{"block":{value:null,writeOnce:true},"parent":{value:null},"blockFillColor":{value:"#3851d2"}}});E.GraphicsBlockRender=C;},"@VERSION@",{use:["base","view","scratch-block-model","dd-plugin","dd-drop-plugin","graphics","substitute","escape"]});
