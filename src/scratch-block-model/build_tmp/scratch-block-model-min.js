YUI.add("scratch-block-model",function(C){var I,H,F,K,B;I=C.Base.create("baseRenderableModel",C.Model,[],{initializer:function(L){if(L&&L.type){this.type=L.type;}},handleRender:function(){var L=this.get("parent");if(L){L.handleRender();}else{this.fire("render");}},getHoverStatus:function(L){return"top";},isValidDropTarget:function(L){return false;}},{INVALID_VALUE:"INVALID",ATTRS:{parent:{value:null}}});H=C.Base.create("baseBlockModel",I,[],{_innerBlocksAllowed:false,_topBlocksAllowed:false,_bottomBlocksAllowed:false,_returnsValue:false,_category:null,_defaultInputBlocks:{},statement:null,type:"block",copy:function(P){var Q=this.get("innerBlocks"),O,M=this.get("inputBlocks"),L={},R=this._defaultInputBlocks,N;if(Q){O=new C.BlockListModel({parent:this});O.get("blocks").add(Q.get("blocks").map(function(T){return T.copy(O);}));}var S=new H({innerBlocks:O,inputBlocks:L,value:this.get("value"),values:this.get("values"),parent:P});if(M){C.each(M,function(U,T){L[T]=U.copy(S);},this);}if(this._defaultInputBlocks){N={};C.each(this._defaultInputBlocks,function(U,T){if(M[T]===U){N[T]=L[T];}else{N[T]=U.copy(S);}},this);}S._innerBlocksAllowed=this._innerBlocksAllowed;S._topBlocksAllowed=this._topBlocksAllowed;S._bottomBlocksAllowed=this._bottomBlocksAllowed;S._returnsValue=this._returnsValue;S._category=this._category;S._defaultInputBlocks=N;S.statement=this.statement;S.type=this.type;return S;},setInputBlock:function(M,N){var L=this.get("inputBlocks");N.set("parent",this);L[M]=N;this.fire("inputBlocksChange");},isValidDropTarget:function(Q){var L,S,M,R,P;var N,T,O;if(Q.type==="blockList"){L=Q.get("blocks");S=L.item(0);M=L.item(L.size()-1);N=S._topBlocksAllowed;T=M._bottomBlocksAllowed;O=L.size()===1&&S._returnsValue;}else{N=Q._topBlocksAllowed;T=Q._bottomBlocksAllowed;O=Q._returnsValue;}return(this._bottomBlocksAllowed&&N)||(this._topBlocksAllowed&&T)||(!this._topBlocksAllowed&&!this._bottomBlocksAllowed&&O&&this.get("parent").type!=="blockList");},getHoverStatus:function(L){if(!(this._bottomBlocksAllowed||this._topBlocksAllowed)){return"self";}else{return L?"top":"bottom";}},init:function(L){H.superclass.init.call(this,L);this.initializeDefaultBlocks();this.after("inputBlocksChange",this.handleRender);},createDefaultNumberInputBlock:function(L){return new H({type:"numberInput",value:L});},createMenuItemWithValues:function(M){var L=C.Array.find(M,function(N){return N.isDefault;});return new H({type:"menuInput",values:M,value:L});},createDegreeWithValues:function(L){return new H({type:"degreeInput",value:L});},createPointTowardsWithValues:function(L){return new H({type:"pointTowards",value:L});},createDefaultEmptyInput:function(L){return new H({type:L});},initializeDefaultBlocks:function(){var M={},L=this.get("inputBlocks");C.each(this._defaultInputBlocks,function(P,O){var N;if(C.Lang.isNumber(P)){N=this.createDefaultNumberInputBlock(P);}else{if(C.Lang.isObject(P)){switch(P.type){case"menu":N=this.createMenuItemWithValues(P.values);break;case"degree":N=this.createDegreeWithValues(P.value);break;case"pointTowards":N=this.createPointTowardsWithValues(P.value);break;default:}}}if(!N){N=this.createDefaultEmptyInput(P);}N.set("parent",this);M[O]=N;if(!L[O]){L[O]=N;}},this);this._defaultInputBlocks=M;},evaluate:function(L){}},{ATTRS:{innerBlocks:{valueFn:function(){return new B({parent:this});},setter:function(L){L.set("parent",this);return L;}},inputBlocks:{value:{}},value:{value:null},values:{value:null}}});F=function(){return new C.ModelList();};K=C.Base.create("programModel",C.Model,[],{},{ATTRS:{background:{valueFn:F},sprites:{valueFn:F}}});B=C.Base.create("blockListModel",I,[],{initializer:function(L){this.after("blocksChange",this.handleRender);},type:"blockList",isValidDropTarget:function(L){return this.get("blocks").size()===0;},splitBlockList:function(N){var P=this.get("blocks"),M=P.indexOf(N),R=new C.ModelList(),L=new C.ModelList(),Q,O;if(M!==-1){for(O=0;O<P.size();O+=1){if(O<M){R.add(P.item(O));}else{L.add(P.item(O));}}this.set("blocks",R);if(R.size()===0&&!this.isInline()){this.destroy();}Q=new B({blocks:L});}return Q;},isInline:function(){return this.get("parent")!==null;}},{ATTRS:{parent:{value:null},x:{value:0},y:{value:0},blocks:{valueFn:F,setter:function(L){if(L){L.each(function(M){M.set("parent",this);},this);}return L;}}}});C.BlockListModel=B;var G=function(){};G.prototype={loadBlocksForCategory:function(L){return C.Array.map(C.SPRITE_BLOCK_DEFINITIONS[L],function(M){return this.initBlockPrototype(M,L);},this);},initBlockPrototype:function(P,N){var M=C.BLOCK_TYPES[P.blockType],O=P.defaultInputBlocks;var L=C.mix({_category:N,_defaultInputBlocks:P.defaultInput?P.defaultInput:{},statement:P.statement},M);return C.Base.create(C.guid(),H,[],L);}};C.BlockDefinitionUtils=new G();var A=C.Base.create("costumeModel",C.Model,[],{},{ATTRS:{width:{value:100},height:{value:100},type:{value:"rect"},style:{value:{}},name:{value:""}}});var J=C.Base.create("spriteModel",C.Model,[],{},{ATTRS:{scripts:{value:F},costumes:{value:F},x:{value:0},y:{value:0},direction:{value:0},costume:{value:null},size:{value:1}}});var D={simpleBlock:{_topBlocksAllowed:true,_bottomBlocksAllowed:true},controlBlock:{_topBlocksAllowed:true,_bottomBlocksAllowed:true,_innerBlocksAllowed:true},valueBlock:{_returnsValue:true}};C.BLOCK_TYPES=D;var E={motion:[{statement:"move {numSteps} steps",blockType:"simpleBlock",defaultInput:{numSteps:10}},{statement:"turn \u21bb {turnRight} degrees",blockType:"simpleBlock",defaultInput:{turnRight:{type:"degree",value:15}}},{statement:"turn \u21ba {turnLeft} degrees",blockType:"simpleBlock",defaultInput:{turnLeft:{type:"degree",value:15}}},{statement:"point in direction {direction}",blockType:"simpleBlock",defaultInput:{direction:{type:"menu",values:[{name:"right",value:90,isDefault:true},{name:"left",value:-90},{name:"up",value:0},{name:"down",value:180}]}}},{statement:"point towards {sprite}",blockType:"simpleBlock",defaultInput:{sprite:{type:"menu",values:[{name:"dummy",value:90,isDefault:true}]}}},{statement:"x position",blockType:"valueBlock"}],control:[{statement:"while {expression}",blockType:"controlBlock",defaultInput:{expression:"blank"}}]};
C.SPRITE_BLOCK_DEFINITIONS=E;},"@VERSION@",{requires:["widget","intl","model","model-list","node-screen"]});